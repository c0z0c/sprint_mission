---
layout: default
title: 흉부 X-Ray 폐렴 분류 프로젝트 보고서
description: 흉부 X-Ray 폐렴 분류 프로젝트 보고서
cache-control: no-cache
date: 2025-08-23
expires: 0
pragma: no-cache
---

# 흉부 X-Ray 폐렴 분류 프로젝트 보고서

## 1. 연구 개요

### 1.1 연구 목적
흉부 X-Ray 이미지를 활용하여 폐렴을 자동으로 분류하는 딥러닝 모델을 개발하고, 다양한 Fine-Tuning 전략을 비교 분석하여 의료 현장에서 실용적으로 활용 가능한 최적 모델을 도출한다.

### 1.2 핵심 연구 질문
- 어떤 모델 아키텍처와 Fine-Tuning 전략이 폐렴 분류에 최적인가?
- 의료진단 관점에서 민감도와 특이도의 최적 균형점은 어디인가?
- 실제 임상 환경에서 배포 가능한 성능 수준은 달성 가능한가?

### 1.3 평가 지표
**의료진단 특화 지표**
- **민감도(Sensitivity)**: 폐렴 환자를 올바르게 진단하는 비율
- **특이도(Specificity)**: 정상 환자를 올바르게 진단하는 비율
- **위음성률**: 폐렴 환자를 놓치는 비율 (낮을수록 좋음)
- **위양성률**: 불필요한 추가 검사 비율

---

## 2. 데이터셋 및 전처리

### 2.1 원본 데이터 현황
**데이터 출처**: Kaggle Chest X-Ray Images (Pneumonia)
- **훈련**: 1,341개 Normal, 3,875개 Pneumonia (불균형 비율 1:2.89)
- **검증**: 8개 Normal, 8개 Pneumonia (통계적으로 부족)
- **테스트**: 234개 Normal, 390개 Pneumonia

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/데이타불균형.png" width="640px"/>

### 2.2 데이터 품질 개선
**중복 데이터 제거**
- 훈련 세트: 26개 중복 제거 (Normal 1개, Pneumonia 25개)
- 테스트 세트: 6개 중복 제거 (각 클래스 3개씩)

**클래스 불균형 해소**
- 데이터 증강을 통한 완전 균형 달성 (1:1 비율)
- 검증 세트 대폭 확장 (16개 → 1,016개)

### 2.3 의료 특화 데이터 증강
**과학적 근거**
- 정상 폐 조직: 공기 충만으로 X-ray 투과율 높음 (밝은 이미지)
- 폐렴 조직: 염증 삼출물로 X-ray 투과율 낮음 (어두운 이미지)

**클래스별 차등 증강 전략**
- **Normal**: 밝기 증강 (+0.05 ~ +0.15)
- **Pneumonia**: 어두운 증강 (-0.15 ~ -0.05)
- **복합 증강**: 밝기 + 회전(±10도) 조합

**12가지 증강 전략 실험 결과**
- CLAHE, 가우시안 블러, 대비 조정, 회전 변환 등 체계적 비교
- **핵심 발견**: 클래스별 차등 밝기 조정이 가장 효과적

- 증강데이타 검토

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/brightness.png" width="640px"/><br/>

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/contrast.png" width="640px"/><br/>

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/rotation.png" width="640px"/><br/>

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/클레스별이미지셈플.png" width="640px"/><br/>

- 히스토그램 검토

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/히스토그램.png" width="640px"/><br/>


### 2.4 최종 데이터셋 구성
- **훈련**: 11,700개 (Normal 5,850개, Pneumonia 5,850개) - 완전 균형
- **검증**: 1,016개 (Normal 508개, Pneumonia 508개) - 통계적 유의성 확보
- **테스트**: 618개 (Normal 231개, Pneumonia 387개) - 원본 분포 유지

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/시험데이타균형.png" width="640px"/><br/>

### 2.5 이미지 해상도 최적화
- **최종 해상도**: 224×224 픽셀
- **정규화**: ImageNet 기준 (Mean: [0.485], Std: [0.229])
- **전처리**: 비율 유지 리사이즈 후 중앙 정렬
-
---

## 3. 연구 방법론

### 3.1 실험 모델
**선정 모델 (4개)**
- **EfficientNet-B0**: 파라미터 효율성과 과적합 방지
- **DenseNet-121**: 특징 재사용을 통한 의료 이미지 최적화
- **ConvNeXt-Tiny**: 최신 아키텍처의 성능 검증
- **ResNet-50**: 의료 이미지 분야 검증된 기준 모델

### 3.2 Fine-Tuning 전략
**3가지 전략 체계적 비교**

| 전략 | 학습 대상 | 학습률 | 에포크 | 특징 |
|------|-----------|--------|--------|------|
| **Frozen** | 분류기만 | 0.001 | 10 | 빠른 학습, 과적합 방지 |
| **Partial** | 마지막 2개 층 + 분류기 | 0.0001 | 15 | 성능-효율성 균형 |
| **Full** | 전체 네트워크 | 0.00001 | 20 | 최대 성능 추구 |

### 3.3 학습 설정
- **해상도**: 224×224 (표준 ImageNet 크기)
- **배치 크기**: 64
- **손실함수**: 가중 교차 엔트로피 (Normal:Pneumonia = 1:1.5)
- **옵티마이저**: Adam
- **스케줄러**: StepLR (step_size=7, gamma=0.1)
- **정규화**: ImageNet 표준 (Mean: [0.485], Std: [0.229])

---

## 4. 실험 결과

### 4.1 전체 실험 결과 요약 (총 12개 모델 조합)

| 순위 | 모델 | 전략 | Test Acc | Sensitivity | Specificity | F1-Score | ROC-AUC |
|------|------|------|----------|-------------|-------------|----------|---------|
| 1 | **DenseNet-121** | Frozen | **0.859** | 0.969 | **0.675** | **0.853** | 0.934 |
| 2 | **ConvNeXt-Tiny** | Frozen | **0.858** | 0.977 | 0.658 | 0.851 | **0.948** |
| 3 | **DenseNet-121** | Partial | 0.845 | 0.964 | 0.645 | 0.838 | 0.927 |
| 4 | **EfficientNet-B0** | Frozen | 0.841 | 0.987 | 0.597 | 0.831 | 0.939 |

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/모델성능비교.png" width="640px"/><br/>

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/시험_모델성능비교.png" width="640px"/><br/>

- Grad-CAM (참고)

<img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/Grad-CAM_정상.png" width="300px"/> <img src="https://c0z0c.github.io/sprint_mission/스프린트미션_완료/image/06_4팀_김명환/Grad-CAM_폐암.png" width="300px"/>

### 4.2 의료진단 핵심 지표 분석

**민감도(Sensitivity) 순위**
1. **ConvNeXt-Tiny Full**: 1.000 (100%) - 폐렴 환자 놓침 0명
2. EfficientNet-B0 Full: 0.997 (99.7%) - 폐렴 환자 놓침 1명
3. DenseNet-121 Full: 0.997 (99.7%) - 폐렴 환자 놓침 1명
4. ResNet-50 Partial/Full: 0.997 (99.7%) - 폐렴 환자 놓침 1명

**특이도(Specificity) 순위**
1. DenseNet-121 Frozen: 0.675 (67.5%) - 정상 환자 오진 75명
2. ConvNeXt-Tiny Frozen: 0.658 (65.8%) - 정상 환자 오진 79명
3. ConvNeXt-Tiny Partial: 0.654 (65.4%) - 정상 환자 오진 80명

### 4.3 의료진 관점에서의 모델 선택

**ConvNeXt-Tiny Full Fine-Tuning 선택 근거**
- **민감도 100%**: 폐렴 환자를 한 명도 놓치지 않음
- **위음성 0명**: 의료진단에서 가장 중요한 지표 달성
- **과적합 우려보다 환자 안전 우선**: 의료 현장에서는 False Negative가 치명적
- **ROC-AUC 최고 수준**: 전반적인 분류 성능도 우수

### 4.4 Fine-Tuning 전략별 분석

**Frozen (Feature Extractor) 전략**
- **최우수**: DenseNet-121 (Test Acc: 85.9%)
- **특징**: 안정적 성능, 빠른 학습, 과적합 위험 낮음

**Partial Fine-Tuning 전략**
- **균형**: DenseNet-121이 전반적으로 우수
- **특징**: 성능-효율성 균형

**Full Fine-Tuning 전략**
- **의료진 선택**: ConvNeXt-Tiny (민감도 100%)
- **특징**: 최대 성능 추구, 과적합 경향 있으나 의료 현장에서는 허용

---

## 5. 의료진단학적 해석

### 5.1 최우수 모델 성능 분석 (의료진 선택)

**ConvNeXt-Tiny + Full Fine-Tuning**
- **테스트 정확도**: 76.5%
- **민감도**: 100% (폐렴 환자 387명 중 387명 정확 진단)
- **특이도**: 37.2% (정상 환자 231명 중 86명 정확 진단)
- **위음성**: 0명 (폐렴 놓침 없음)
- **위양성**: 145명 (불필요한 추가 검사)

### 5.2 임상적 의미

**민감도 관점**
- 100%는 의료 현장에서 이상적인 수준
- 폐렴 환자 놓침률 0%는 의료진에게 매우 중요

**특이도 관점**
- 37.2%로 낮으나, 의료진단에서는 False Negative보다 False Positive가 훨씬 안전
- 추가 검사를 통해 최종 확진 가능

### 5.3 활용 시나리오별 권고안

**1순위: 완벽한 스크리닝 시스템 (의료진 선택)**
- **모델**: ConvNeXt-Tiny + Full Fine-Tuning
- **용도**: 1차 스크리닝, 응급실 초기 진단
- **장점**: 100% 민감도로 폐렴 환자 놓침 절대 없음

**2순위: 균형잡힌 진단 보조 시스템**
- **모델**: DenseNet-121 + Frozen
- **용도**: 방사선과 전문의 판독 보조
- **장점**: 전반적으로 균형 잡힌 성능

**3순위: 고정밀 진단 시스템**
- **모델**: ConvNeXt-Tiny + Frozen
- **용도**: 정밀 진단이 필요한 환경
- **장점**: 높은 ROC-AUC (0.948)와 우수한 특이도

---

## 6. 결론

### 6.1 핵심 연구 성과
본 연구는 의료진단 특성을 고려했을 때 **ConvNeXt-Tiny + Full Fine-Tuning 조합**이 최적임을 실험적으로 입증했다. 100%의 민감도는 폐렴 환자를 한 명도 놓치지 않는 완벽한 스크리닝 시스템을 구현한다.

### 6.2 최종 권고 모델

**의료 현장 1차 스크리닝용 (최우선 선택)**
- **모델**: ConvNeXt-Tiny + Full Fine-Tuning
- **성능**: Test Acc 76.5%, Sensitivity 100%, Specificity 37.2%
- **용도**: 응급실, 야간 진료, 1차 스크리닝 시스템
- **핵심**: 폐렴 환자 놓침 절대 없음

**종합 진단 보조용 (2순위)**
- **모델**: DenseNet-121 + Frozen
- **성능**: Test Acc 85.9%, Sensitivity 96.9%, Specificity 67.5%
- **용도**: 방사선과 전문의 진단 보조 시스템

### 6.3 의료진 관점의 최종 결론

의료 현장에서는 **과적합 우려보다 환자 안전이 절대 우선**이다. ConvNeXt-Tiny Full Fine-Tuning 모델의 100% 민감도는 폐렴 환자를 한 명도 놓치지 않는 완벽한 스크리닝을 제공하며, 낮은 특이도로 인한 추가 검사는 의료진의 최종 판단으로 해결 가능하다.

**핵심 메시지**: 의료진단에서는 False Negative(놓침)를 방지하는 것이 False Positive(오진)보다 훨씬 중요하며, 이 관점에서 ConvNeXt-Tiny Full 모델이 최적 선택이다.

---

