// ëª¨ë“  í´ë” ë° íŒŒì¼ êµ¬ì¡°ë¥¼ íŠ¸ë¦¬ í˜•íƒœë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
function buildFolderTree(files, pages, currentDir) {
const tree = {};

// currentDir ì •ê·œí™”
const normalizedCurrentDir = currentDir === '/' ? '/' : currentDir.endsWith('/') ? currentDir : currentDir + '/';

// filesì—ì„œ í´ë” êµ¬ì¡° ì¶”ì¶œ
files.forEach(file => {
const filePath = file.path;
if (filePath.startsWith(normalizedCurrentDir)) {
const relativePath = filePath.substring(normalizedCurrentDir.length);
addToTree(tree, relativePath, 'file', file);
}
});

// pagesì—ì„œ í´ë” êµ¬ì¡° ì¶”ì¶œ (md íŒŒì¼ ì œì™¸)
pages.forEach(page => {
const pagePath = page.path;
if (pagePath.startsWith('/md/') || pagePath.startsWith('/assets/')) return;

if (pagePath.startsWith(normalizedCurrentDir)) {
const relativePath = pagePath.substring(normalizedCurrentDir.length);
addToTree(tree, relativePath, 'page', page);
}
});

return tree;
}

// íŠ¸ë¦¬ì— ê²½ë¡œ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function addToTree(tree, path, type, item) {
const parts = path.split('/').filter(part => part !== '');
let currentLevel = tree;

for (let i = 0; i < parts.length; i++) { const part=parts[i]; if (!currentLevel[part]) { currentLevel[part]={ name:
  part, type: i===parts.length - 1 ? type : 'folder' , item: i===parts.length - 1 ? item : null, children: {} }; }
  currentLevel=currentLevel[part].children; } } // í´ë” ì •ë³´ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ function getFolderInfo(folderName) { const
  folderMappings={ 'ë©˜í† ' : { icon: 'ğŸ‘¨â€ğŸ«' , desc: 'ë©˜í†  ê´€ë ¨ ìë£Œ' }, 'ìŠ¤í”„ë¦°íŠ¸ë¯¸ì…˜_ì™„ë£Œ' : { icon: 'âœ…' , desc: 'ì™„ë£Œëœ ìŠ¤í”„ë¦°íŠ¸ ë¯¸ì…˜ë“¤'
  }, 'ìŠ¤í”„ë¦°íŠ¸ë¯¸ì…˜_ì‘ì—…ì¤‘' : { icon: 'ğŸš§' , desc: 'ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ë“¤' }, 'ìœ„í´ë¦¬í˜ì´í¼' : { icon: 'ğŸ“°' , desc: 'ì£¼ê°„ í•™ìŠµ ë¦¬í¬íŠ¸' }, 'ìŠ¤í„°ë””' : {
  icon: 'ğŸ“’' , desc: 'í•™ìŠµ ìë£Œ' }, 'ì‹¤ìŠµ' : { icon: 'ğŸ”¬' , desc: 'ì‹¤ìŠµ ìë£Œ' }, 'ë°±ì—…' : { icon: 'ğŸ’¾' , desc: 'ë°±ì—… íŒŒì¼ë“¤' }, 'ì…ˆí”Œ' : {
  icon: 'ğŸ“‚' , desc: 'ìƒ˜í”Œ íŒŒì¼ë“¤' }, 'í…ŒìŠ¤íŠ¸' : { icon: 'ğŸ§ª' , desc: 'í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤' }, 'image' : { icon: 'ğŸ–¼ï¸' , desc: 'ì´ë¯¸ì§€ íŒŒì¼ë“¤'
  }, 'Learning' : { icon: 'ğŸ“š' , desc: 'í•™ìŠµ ìë£Œ' }, 'Learning Daily' : { icon: 'ğŸ“…' , desc: 'ì¼ì¼ í•™ìŠµ ê¸°ë¡' }, 'md' : {
  icon: 'ğŸ“' , desc: 'Markdown ë¬¸ì„œ' }, 'íšŒì˜ë¡' : { icon: 'ğŸ“‹' , desc: 'íŒ€ íšŒì˜ë¡' }, 'assets' : { icon: 'ğŸ¨' , desc: 'ì •ì  ìì›'
  }, 'ê²½êµ¬ì•½ì œì´ë¯¸ì§€ë°ì´í„°' : { icon: 'ğŸ’Š' , desc: 'ì•½ë¬¼ ë°ì´í„°' }, 'AI ëª¨ë¸ í™˜ê²½ ì„¤ì¹˜ê°€ì´ë“œ' : { icon: 'âš™ï¸' , desc: 'ì„¤ì¹˜ ê°€ì´ë“œ'
  }, 'ê²½êµ¬ì•½ì œ ì´ë¯¸ì§€ ë°ì´í„°(ë°ì´í„° ì„¤ëª…ì„œ, ê²½êµ¬ì•½ì œ ë¦¬ìŠ¤íŠ¸)' : { icon: 'ğŸ“Š' , desc: 'ë°ì´í„° ì„¤ëª…ì„œ' }, 'ë°œí‘œìë£Œ' : { icon: 'ğŸ“Š' , desc: 'ë°œí‘œ ìë£Œ'
  }, 'í˜‘ì—…ì¼ì§€' : { icon: 'ğŸ““' , desc: 'í˜‘ì—… ì¼ì§€' } }; return folderMappings[folderName] || { icon: 'ğŸ“' , desc: 'í´ë”' }; } //
  íŒŒì¼ ì•„ì´ì½˜ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ function getFileIcon(filename) { const ext=filename.split('.').pop().toLowerCase(); const
  iconMap={ 'md' : 'ğŸ“' , 'ipynb' : 'ğŸ“Š' , 'py' : 'ğŸ' , 'js' : 'ğŸ’›' , 'html' : 'ğŸŒ' , 'css' : 'ğŸ¨' , 'json' : 'ğŸ“‹'
  , 'txt' : 'ğŸ“„' , 'pdf' : 'ğŸ“‘' , 'jpg' : 'ğŸ–¼ï¸' , 'jpeg' : 'ğŸ–¼ï¸' , 'png' : 'ğŸ–¼ï¸' , 'gif' : 'ğŸ–¼ï¸' , 'svg' : 'ğŸ¯' };
  return iconMap[ext] || 'ğŸ“„' ; } // íŠ¸ë¦¬ HTML ìƒì„± í•¨ìˆ˜ function renderTreeNode(node, path, level=0) { const indent='  '
  .repeat(level); const isFolder=node.type==='folder' ; const info=isFolder ? getFolderInfo(node.name) : { icon:
  getFileIcon(node.name), desc: node.name }; const fullPath=path ? `${path}/${node.name}` : node.name; let
  html=`${indent}<div class="tree-node" data-level="${level}">`;

  if (isFolder) {
  const cleanPath = curDir.replace(/\/$/, '') + '/' + fullPath;
  html += `
  ${indent} <div class="tree-folder" onclick="toggleFolder(this)" data-path="${fullPath}">
    ${indent} <span class="tree-toggle">â–¶</span>
    ${indent} <span class="tree-icon">${info.icon}</span>
    ${indent} <span class="tree-name">${node.name}</span>
    ${indent} <span class="tree-count">(${Object.keys(node.children).length})</span>
    ${indent} <a href="${project_url}${cleanPath}/" class="tree-link" title="í´ë” ì—´ê¸°">ğŸ“–</a>
    ${indent} </div>
  ${indent} <div class="tree-children" style="display: none;">
    `;

    // ìì‹ ë…¸ë“œë“¤ì„ ì •ë ¬í•˜ì—¬ ë Œë”ë§ (í´ë” ë¨¼ì €, ê·¸ ë‹¤ìŒ íŒŒì¼)
    const children = Object.values(node.children).sort((a, b) => {
    if (a.type === 'folder' && b.type !== 'folder') return -1;
    if (a.type !== 'folder' && b.type === 'folder') return 1;
    return a.name.localeCompare(b.name);
    });

    children.forEach(child => {
    html += renderTreeNode(child, fullPath, level + 1);
    });

    html += `${indent} </div>`;
  } else {
  // íŒŒì¼ì¸ ê²½ìš°
  const fileUrl = node.item && node.item.url ? node.item.url : '#';
  html += `
  ${indent} <div class="tree-file">
    ${indent} <span class="tree-icon">${info.icon}</span>
    ${indent} <span class="tree-name">${node.name}</span>
    ${indent} <a href="${fileUrl}" class="tree-link" title="íŒŒì¼ ì—´ê¸°">ğŸ“–</a>
    ${indent} </div>
  `;
  }

  html += `${indent}</div>`;
  return html;
  }

  // í´ë” í† ê¸€ í•¨ìˆ˜
  function toggleFolder(element) {
  const children = element.nextElementSibling;
  const toggle = element.querySelector('.tree-toggle');

  if (children.style.display === 'none') {
  children.style.display = 'block';
  toggle.textContent = 'â–¼';
  } else {
  children.style.display = 'none';
  toggle.textContent = 'â–¶';
  }
  }

  // DOMì´ ë¡œë“œëœ í›„ í´ë” íŠ¸ë¦¬ ë Œë”ë§
  document.addEventListener('DOMContentLoaded', function() {
  // í´ë” íŠ¸ë¦¬ ìƒì„±
  const allFilesData = allFiles;
  const allPagesData = allPages;
  const folderTree = buildFolderTree(allFilesData, allPagesData, curDir);

  // í´ë” ëª©ë¡ ë Œë”ë§
  const folderGrid = document.querySelector('.folder-grid');
  if (folderGrid) {
  if (Object.keys(folderTree).length === 0) {
  folderGrid.innerHTML = `
  <div class="empty-message">
    <span class="empty-icon">ğŸ“</span>
    <h3>í•˜ìœ„ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
    <p>í˜„ì¬ ìœ„ì¹˜ì—ëŠ” í•˜ìœ„ í´ë”ë‚˜ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  </div>
  `;
  } else {
  let treeHtml = '<div class="folder-tree">';

    // ë£¨íŠ¸ ë ˆë²¨ ë…¸ë“œë“¤ì„ ì •ë ¬í•˜ì—¬ ë Œë”ë§
    const rootNodes = Object.values(folderTree).sort((a, b) => {
    if (a.type === 'folder' && b.type !== 'folder') return -1;
    if (a.type !== 'folder' && b.type === 'folder') return 1;
    return a.name.localeCompare(b.name);
    });

    rootNodes.forEach(node => {
    treeHtml += renderTreeNode(node, '', 0);
    });

    treeHtml += '</div>';

  // CSS ìŠ¤íƒ€ì¼ ì¶”ê°€
  treeHtml += `
  <style>
    .folder-tree {
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.4;
      border: 1px solid #e1e4e8;
      border-radius: 6px;
      background: #f8f9fa;
      padding: 16px;
      margin: 16px 0;
    }

    .tree-node {
      margin: 2px 0;
    }

    .tree-folder,
    .tree-file {
      display: flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
      cursor: pointer;
    }

    .tree-folder:hover,
    .tree-file:hover {
      background-color: #e8f4f8;
    }

    .tree-toggle {
      margin-right: 8px;
      color: #666;
      font-size: 12px;
      width: 16px;
      text-align: center;
    }

    .tree-icon {
      margin-right: 8px;
      font-size: 16px;
    }

    .tree-name {
      flex: 1;
      color: #333;
      font-weight: 500;
    }

    .tree-count {
      margin-left: 8px;
      color: #666;
      font-size: 12px;
    }

    .tree-link {
      margin-left: 8px;
      text-decoration: none;
      font-size: 14px;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .tree-link:hover {
      opacity: 1;
    }

    .tree-children {
      margin-left: 24px;
      border-left: 1px solid #e1e4e8;
      padding-left: 8px;
    }

    .tree-file .tree-name {
      font-weight: normal;
    }
  </style>
  `;

  folderGrid.innerHTML = treeHtml;
  }
  }
  });

  /*
  <div class="folder-grid">
    <!-- í´ë” íŠ¸ë¦¬ê°€ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
  </div>
  */