
// í•˜ìœ„ í´ë” ëª©ë¡ íŒŒì‹± í•¨ìˆ˜
function getSubDirectories(files, pages, currentDir) {
  const subDirs = new Set();
  
  // currentDir ì •ê·œí™” (í•­ìƒ /ë¡œ ëë‚˜ë„ë¡)
  const normalizedCurrentDir = currentDir === '/' ? '/' : currentDir.endsWith('/') ? currentDir : currentDir + '/';
  
  // filesì—ì„œ í•˜ìœ„ í´ë” ì¶”ì¶œ
  files.forEach(file => {
    const filePath = file.path;
    
    // í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ì§ì ‘ì ì¸ í•˜ìœ„ í´ë”ë§Œ ì°¾ê¸°
    if (normalizedCurrentDir === '/') {
      // ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì¸ ê²½ìš°
      if (filePath.startsWith('/') && filePath.indexOf('/', 1) > 0) {
        const firstSlashIndex = filePath.indexOf('/', 1);
        const subFolderName = filePath.substring(1, firstSlashIndex);
        const subDirPath = '/' + subFolderName + '/';
        subDirs.add(subDirPath);
      }
    } else {
      // í•˜ìœ„ ë””ë ‰í† ë¦¬ì¸ ê²½ìš°
      if (filePath.startsWith(normalizedCurrentDir)) {
        const remainingPath = filePath.substring(normalizedCurrentDir.length);
        const slashIndex = remainingPath.indexOf('/');
        if (slashIndex > 0) {
          const subFolderName = remainingPath.substring(0, slashIndex);
          const subDirPath = normalizedCurrentDir + subFolderName + '/';
          subDirs.add(subDirPath);
        }
      }
    }
  });

  // pagesì—ì„œ í•˜ìœ„ í´ë” ì¶”ì¶œ (md íŒŒì¼ ì œì™¸í•˜ê³  ëª¨ë“  í˜ì´ì§€ ì²˜ë¦¬)
  pages.forEach(page => {
    const pagePath = page.path;

    if (pagePath.startsWith('/md/')) return;
    if (pagePath.startsWith('/assets/')) return;
    
    // í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ì§ì ‘ì ì¸ í•˜ìœ„ í´ë”ë§Œ ì°¾ê¸°
    if (normalizedCurrentDir === '/') {
      // ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì¸ ê²½ìš°
      if (pagePath.startsWith('/') && pagePath.indexOf('/', 1) > 0) {
        const firstSlashIndex = pagePath.indexOf('/', 1);
        const subFolderName = pagePath.substring(1, firstSlashIndex);
        const subDirPath = '/' + subFolderName + '/';
        subDirs.add(subDirPath);
      }
    } else {
      // í•˜ìœ„ ë””ë ‰í† ë¦¬ì¸ ê²½ìš°
      if (pagePath.startsWith(normalizedCurrentDir)) {
        const remainingPath = pagePath.substring(normalizedCurrentDir.length);
        const slashIndex = remainingPath.indexOf('/');
        if (slashIndex > 0) {
          const subFolderName = remainingPath.substring(0, slashIndex);
          const subDirPath = normalizedCurrentDir + subFolderName + '/';
          subDirs.add(subDirPath);
        }
      }
    }
  });
  
  const result = Array.from(subDirs).sort();
  
  return result;
}

// í´ë” ì •ë³´ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
function getFolderInfo(folderName) {
  // í´ë”ëª…ì— ë”°ë¥¸ ì•„ì´ì½˜ê³¼ ì„¤ëª… (index.mdì™€ ìœ ì‚¬í•˜ê²Œ)
  const folderMappings = {
    'ë©˜í† ': { icon: 'ğŸ‘¨â€ğŸ«', desc: 'ë©˜í†  ê´€ë ¨ ìë£Œ' },
    'ìŠ¤í”„ë¦°íŠ¸ë¯¸ì…˜_ì™„ë£Œ': { icon: 'âœ…', desc: 'ì™„ë£Œëœ ìŠ¤í”„ë¦°íŠ¸ ë¯¸ì…˜ë“¤' },
    'ìŠ¤í”„ë¦°íŠ¸ë¯¸ì…˜_ì‘ì—…ì¤‘': { icon: 'ğŸš§', desc: 'ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ë“¤' },
    'ìœ„í´ë¦¬í˜ì´í¼': { icon: 'ğŸ“°', desc: 'ì£¼ê°„ í•™ìŠµ ë¦¬í¬íŠ¸' },
    'ìŠ¤í„°ë””': { icon: 'ğŸ“’', desc: 'í•™ìŠµ ìë£Œ' },
    'ì‹¤ìŠµ': { icon: 'ğŸ”¬', desc: 'ì‹¤ìŠµ ìë£Œ' },
    'ë°±ì—…': { icon: 'ğŸ’¾', desc: 'ë°±ì—… íŒŒì¼ë“¤' },
    'ì…ˆí”Œ': { icon: 'ğŸ“‚', desc: 'ìƒ˜í”Œ íŒŒì¼ë“¤' },
    'í…ŒìŠ¤íŠ¸': { icon: 'ğŸ§ª', desc: 'í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤' },
    'image': { icon: 'ğŸ–¼ï¸', desc: 'ì´ë¯¸ì§€ íŒŒì¼ë“¤' },
    'Learning': { icon: 'ğŸ“š', desc: 'í•™ìŠµ ìë£Œ' },
    'Learning Daily': { icon: 'ğŸ“…', desc: 'ì¼ì¼ í•™ìŠµ ê¸°ë¡' },
    'md': { icon: 'ğŸ“', desc: 'Markdown ë¬¸ì„œ' },
    'íšŒì˜ë¡': { icon: 'ğŸ“‹', desc: 'íŒ€ íšŒì˜ë¡' },
    'assets': { icon: 'ğŸ¨', desc: 'ì •ì  ìì›' },
    'ê²½êµ¬ì•½ì œì´ë¯¸ì§€ë°ì´í„°': { icon: 'ğŸ’Š', desc: 'ì•½ë¬¼ ë°ì´í„°' },
    'AI ëª¨ë¸ í™˜ê²½ ì„¤ì¹˜ê°€ì´ë“œ': { icon: 'âš™ï¸', desc: 'ì„¤ì¹˜ ê°€ì´ë“œ' },
    'ê²½êµ¬ì•½ì œ ì´ë¯¸ì§€ ë°ì´í„°(ë°ì´í„° ì„¤ëª…ì„œ, ê²½êµ¬ì•½ì œ ë¦¬ìŠ¤íŠ¸)': { icon: 'ğŸ“Š', desc: 'ë°ì´í„° ì„¤ëª…ì„œ' },
    'ë°œí‘œìë£Œ': { icon: 'ğŸ“Š', desc: 'ë°œí‘œ ìë£Œ' },
    'í˜‘ì—…ì¼ì§€': { icon: 'ğŸ““', desc: 'í˜‘ì—… ì¼ì§€' }
  };
  
  return folderMappings[folderName] || { icon: 'ğŸ“', desc: 'í´ë”' };
}

// DOMì´ ë¡œë“œëœ í›„ í´ë” íŠ¸ë¦¬ ë Œë”ë§
document.addEventListener('DOMContentLoaded', function() {
  // í•˜ìœ„ í´ë” ëª©ë¡ ìƒì„±
  const allFilesData = allFiles;
  const allPagesData = allPages;
  const subDirectories = getSubDirectories(allFilesData, allPagesData, curDir);
  
  // í´ë” íŠ¸ë¦¬ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
  const folderLinksContainer = document.querySelector('.folder-links');
  if (folderLinksContainer) {
    if (subDirectories.length === 0) {
      folderLinksContainer.innerHTML = `
        <div class="empty-message" style="text-align: center; padding: 20px; color: #666;">
          <span style="font-size: 48px; display: block; margin-bottom: 10px;">ğŸ“</span>
          <h3>í•˜ìœ„ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
          <p>í˜„ì¬ ìœ„ì¹˜ì—ëŠ” í•˜ìœ„ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      `;
    } else {
      let folderLinksHtml = '';
      subDirectories.forEach(folderPath => {
        const folderName = folderPath.split("/").filter(s => s).pop() || "root";
        const folderInfo = getFolderInfo(folderName);
        const cleanPath = folderPath.replace(/\/$/, ''); // ëì˜ / ì œê±°
        
        folderLinksHtml += `
          <a href="${project_url}${cleanPath}/" class="folder-link">
            <span class="folder-icon">${folderInfo.icon}</span>
            <span class="folder-name">${folderName}</span>
            <span class="folder-desc">${folderInfo.desc}</span>
          </a>
        `;
      });
      
      folderLinksContainer.innerHTML = folderLinksHtml;
    }
  }
});

